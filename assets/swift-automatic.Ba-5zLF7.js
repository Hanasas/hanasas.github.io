import{_ as y}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CdCgGCEk.js";import{e as c,a as F,u as o}from"./chunks/vue-router.CRRX0jay.js";import{N as u,a3 as a,U as h,S as i,W as s,u as C,O as m,E as B}from"./framework.VTn4SQHu.js";import"./app.Bho2iUbc.js";import"./chunks/dayjs.DPscOGnl.js";import"./chunks/@vueuse/motion.Cs3PXLQO.js";import"./chunks/vue-i18n.Bbx_Eog3.js";import"./chunks/pinia.D09Bv-rL.js";import"./chunks/nprogress.DgNGesC2.js";import"./YunComment.vue_vue_type_style_index_0_lang.56pr6m9W.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.Co5abI3r.js";const A=c("/posts/swift-automatic",async t=>JSON.parse('{"title":"Swift原子化实现方式的讨论","description":"","frontmatter":{"title":"Swift原子化实现方式的讨论","date":"2025-03-22","updated":"2025-03-22","categories":"Swift 笔记","tags":["Swift","笔记"],"top":1},"headers":[],"relativePath":"pages/posts/swift-automatic.md","lastUpdated":1749173190000}'),{lazy:(t,k)=>t.name===k.name}),q={__name:"swift-automatic",setup(t,{expose:k}){var r;const{data:e}=A(),p=o(),d=F(),n=Object.assign(d.meta.frontmatter||{},((r=e.value)==null?void 0:r.frontmatter)||{});return p.currentRoute.value.data=e.value,B("valaxy:frontmatter",n),globalThis.$frontmatter=n,k({frontmatter:{title:"Swift原子化实现方式的讨论",date:"2025-03-22",updated:"2025-03-22",categories:"Swift 笔记",tags:["Swift","笔记"],top:1}}),(l,E)=>{const g=y;return m(),u(g,{frontmatter:C(n)},{"main-content-md":a(()=>E[0]||(E[0]=[i("p",null,"下面整理了一份关于 Swift 编程中如何实现原子化（atomic）的文档，从原子操作的基本概念讲起，然后介绍在 Swift 中可采用的几种常见实现方式及示例代码，供大家参考和学习。",-1),i("hr",null,null,-1),i("p",null,[i("strong",null,"Swift 中的原子化实现方式探讨")],-1),i("p",null,"在多线程和并发编程中，“原子性”是确保数据访问和修改过程不被其他线程干扰的关键特性。虽然 Swift 标准库中没有提供直接的原子变量类型，但我们可以通过多种方式来实现原子操作。本文将介绍以下几种方法：",-1),i("ol",null,[i("li",null,[i("p",null,[i("strong",null,"使用串行队列（DispatchQueue）")])]),i("li",null,[i("p",null,[i("strong",null,"使用锁（NSLock）")])]),i("li",null,[i("p",null,[i("strong",null,"使用属性包装器（Property Wrapper）")])]),i("li",null,[i("p",null,[i("strong",null,"利用 Dispatch Barrier 优化并发访问")])]),i("li",null,[i("p",null,[i("strong",null,"利用 Actor 模型进行状态隔离（Swift 5.5+）")])]),i("li",null,[i("p",null,[i("strong",null,"传统的 C/C++ 原子操作方法（如 OSAtomic，但已过时）")])])],-1),i("hr",null,null,-1),i("h2",{id:"_1-什么是原子性",tabindex:"-1"},[i("strong",null,"1. 什么是原子性"),s(),i("a",{class:"header-anchor",href:"#_1-什么是原子性","aria-label":'Permalink to "**1. 什么是原子性**"'},"​")],-1),i("p",null,"原子操作指的是一个不可分割的操作序列，要么全部执行完毕，要么完全没有执行。这样可以防止在多线程环境下出现数据竞争（race condition）或数据不一致的问题。常见的应用场景包括计数器、自增/自减操作以及需要对共享资源进行读写的情况。",-1),i("hr",null,null,-1),i("h2",{id:"_2-为什么需要原子操作",tabindex:"-1"},[i("strong",null,"2. 为什么需要原子操作"),s(),i("a",{class:"header-anchor",href:"#_2-为什么需要原子操作","aria-label":'Permalink to "**2. 为什么需要原子操作**"'},"​")],-1),i("p",null,"在并发环境下，如果多个线程同时读取和写入某个变量而没有同步机制，会导致数据状态混乱、数据竞争甚至崩溃。通过采用原子化操作，可以确保一个线程在对共享数据进行更新时，其他线程不会在中途读取到不完整的数据状态，从而有效提高程序的健壮性和安全性。",-1),i("hr",null,null,-1),i("h2",{id:"_3-常见的原子操作实现方式",tabindex:"-1"},[i("strong",null,"3. 常见的原子操作实现方式"),s(),i("a",{class:"header-anchor",href:"#_3-常见的原子操作实现方式","aria-label":'Permalink to "**3. 常见的原子操作实现方式**"'},"​")],-1),i("h3",{id:"_3-1-使用串行队列-dispatchqueue",tabindex:"-1"},[i("strong",null,"3.1 使用串行队列（DispatchQueue）"),s(),i("a",{class:"header-anchor",href:"#_3-1-使用串行队列-dispatchqueue","aria-label":'Permalink to "**3.1 使用串行队列（DispatchQueue）**"'},"​")],-1),i("p",null,"利用串行队列可以确保访问共享资源的操作按照先后顺序执行。示例代码如下：",-1),i("div",{class:"language-swift vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"swift"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AtomicInt"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," queue "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," DispatchQueue"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"label"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"com.example.atomicInt"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," _value: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Int"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," queue."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"sync"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { _value }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            queue."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"sync"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { _value "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newValue }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," increment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        queue."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"sync"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { _value "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," atomicInt "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," AtomicInt"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"atomicInt."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"increment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Atomic value is '),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\\(atomicInt."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"value"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},")"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),i("button",{class:"collapse"})],-1),i("p",null,"在以上示例中，每次访问 _value 都是通过 queue.sync 完成的，从而确保访问的原子性。",-1),i("hr",null,null,-1),i("h3",{id:"_3-2-使用-nslock",tabindex:"-1"},[i("strong",null,"3.2 使用 NSLock"),s(),i("a",{class:"header-anchor",href:"#_3-2-使用-nslock","aria-label":'Permalink to "**3.2 使用 NSLock**"'},"​")],-1),i("p",null,"NSLock 为我们提供了一个简单的锁机制，通过在读写操作前加锁、操作完成后解锁来确保线程安全。示例代码如下：",-1),i("div",{class:"language-swift vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"swift"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AtomicIntWithLock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," _value: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Int"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," lock "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," NSLock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            lock."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"lock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            defer"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { lock."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"unlock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," _value")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            lock."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"lock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            _value "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newValue")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            lock."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"unlock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," increment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        lock."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"lock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        _value "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        lock."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"unlock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," atomicIntLock "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," AtomicIntWithLock"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"atomicIntLock."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"increment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Atomic value with lock is '),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\\(atomicIntLock."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"value"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},")"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),i("button",{class:"collapse"})],-1),i("p",null,"使用 NSLock 可以较为直接地控制代码的互斥执行。",-1),i("hr",null,null,-1),i("h3",{id:"_3-3-使用属性包装器-property-wrapper",tabindex:"-1"},[i("strong",null,"3.3 使用属性包装器（Property Wrapper）"),s(),i("a",{class:"header-anchor",href:"#_3-3-使用属性包装器-property-wrapper","aria-label":'Permalink to "**3.3 使用属性包装器（Property Wrapper）**"'},"​")],-1),i("p",null,"Swift 5.1 之后引入的属性包装器使得封装原子操作变得更加直观。我们可以将同步逻辑抽象到属性包装器中，这样使用时只需在变量声明时加上包装器即可：",-1),i("div",{class:"language-swift vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"swift"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"@propertyWrapper")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"struct"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Atomic"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Value"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Value")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," queue "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," DispatchQueue"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"label"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"com.example.atomicProperty"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    init"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"wrappedValue"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Value"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        self"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"value"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," wrappedValue")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," wrappedValue: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Value"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            queue."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"sync"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { value }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            queue."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"sync"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { value "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," newValue }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," SomeClass"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    @Atomic"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," counter: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Int"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," increment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        counter "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," obj "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," SomeClass"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"obj."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"increment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Atomic property counter: '),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\\(obj."),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"counter"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},")"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")])])]),i("button",{class:"collapse"})],-1),i("p",null,"这种方式不仅代码更简洁，而且能很方便地复用于不同数据类型。",-1),i("hr",null,null,-1),i("h3",{id:"_3-4-使用-dispatch-barrier-优化并发访问",tabindex:"-1"},[i("strong",null,"3.4 使用 Dispatch Barrier 优化并发访问"),s(),i("a",{class:"header-anchor",href:"#_3-4-使用-dispatch-barrier-优化并发访问","aria-label":'Permalink to "**3.4 使用 Dispatch Barrier 优化并发访问**"'},"​")],-1),i("p",null,"如果需要在并发队列中对资源进行读写操作，可以采用 Dispatch Barrier 来确保写操作的原子性，同时允许多个并发读操作，从而提高性能。例如：",-1),i("div",{class:"language-swift vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"swift"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AtomicArray"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"<"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Element"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," array: ["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Element"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," []")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," concurrentQueue "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," DispatchQueue"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"label"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"com.example.atomicArray"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"attributes"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": .concurrent)")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," elements: ["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Element"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," concurrentQueue."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"sync"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { array }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," append"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"_"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," element: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Element"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        concurrentQueue."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"async"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"flags"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": .barrier) {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"            self"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"array"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"append"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(element)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," atomicArray "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," AtomicArray"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Int"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"atomicArray."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"append"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"atomicArray."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"append"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"2"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"DispatchQueue."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"global"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"async"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Array elements: '),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\\(atomicArray."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"elements"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},")"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),i("p",null,"这里使用 async(flags: .barrier) 保证写操作时其他读写任务不会并发执行，从而实现数据的一致性维护。",-1),i("hr",null,null,-1),i("h3",{id:"_3-5-利用-actor-模型-swift-concurrency",tabindex:"-1"},[i("strong",null,"3.5 利用 Actor 模型（Swift Concurrency）"),s(),i("a",{class:"header-anchor",href:"#_3-5-利用-actor-模型-swift-concurrency","aria-label":'Permalink to "**3.5 利用 Actor 模型（Swift Concurrency）**"'},"​")],-1),i("p",null,"从 Swift 5.5 开始，Swift 引入了 Actor 概念，通过将状态封装在 actor 内部，就能保证对内部状态的访问都是串行的，从而实现天然的线程安全。例如：",-1),i("div",{class:"language-swift vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"swift"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"actor"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," AtomicCounter"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," var"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value: "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Int"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," increment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        value "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    func"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getValue"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," Int"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 使用 Actor")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," counter "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," AtomicCounter"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"Task"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    await"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," counter."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"increment"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    let"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," currentValue "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," await"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," counter."),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"getValue"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    print"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Actor atomic counter: '),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"\\(currentValue)"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),i("button",{class:"collapse"})],-1),i("p",null,"Actor 模型不仅语法简洁，而且与 Swift 的并发特性相结合，非常适合编写线程安全的代码。",-1),i("hr",null,null,-1),i("h3",{id:"_3-6-传统的-c-c-原子操作",tabindex:"-1"},[i("strong",null,"3.6 传统的 C/C++ 原子操作"),s(),i("a",{class:"header-anchor",href:"#_3-6-传统的-c-c-原子操作","aria-label":'Permalink to "**3.6 传统的 C/C++ 原子操作**"'},"​")],-1),i("p",null,"在 Swift 中，曾经可以通过调用 libkern 提供的一些 C 库函数（如 OSAtomic）来实现原子操作，但这些 API 已被标记为过时并不推荐使用。在需要极致性能和底层操作时，可考虑引入 C++ 中的 std::atomic，或者依赖第三方库封装。但由于 Swift 本身提倡更高级的并发抽象，因此推荐优先考虑 GCD、NSLock 或 Actor 模型等方式。",-1),i("hr",null,null,-1),i("h2",{id:"_4-性能与适用场景分析",tabindex:"-1"},[i("strong",null,"4. 性能与适用场景分析"),s(),i("a",{class:"header-anchor",href:"#_4-性能与适用场景分析","aria-label":'Permalink to "**4. 性能与适用场景分析**"'},"​")],-1),i("p",null,[s("• "),i("strong",null,"串行队列"),s("：实现简单，但在高并发场景下可能导致串行瓶颈。适合数据量不大或对性能要求不苛刻的场景。")],-1),i("p",null,[s("• "),i("strong",null,"NSLock"),s("：互斥锁实现原子性，开销较小，但需谨防死锁问题，使用时注意锁的正确释放。")],-1),i("p",null,[s("• "),i("strong",null,"属性包装器"),s("：封装性好，便于复用与维护。适合封装常用的简单数据类型。")],-1),i("p",null,[s("• "),i("strong",null,"Dispatch Barrier"),s("：在读多写少的场景中可以发挥优势，既保证写操作的原子性，又允许并行读操作。")],-1),i("p",null,[s("• "),i("strong",null,"Actor 模型"),s("：适用于 Swift 并发环境下的状态管理，能够充分利用异步特性，实现代码简洁的同时保持线程安全。")],-1),i("p",null,"选择哪种实现方式往往要根据具体需求、并发量以及代码的复杂度做出权衡。",-1),i("hr",null,null,-1),i("h2",{id:"_5-总结",tabindex:"-1"},[i("strong",null,"5. 总结"),s(),i("a",{class:"header-anchor",href:"#_5-总结","aria-label":'Permalink to "**5. 总结**"'},"​")],-1),i("p",null,"在 Swift 编程中，实现原子化操作主要依赖于任务调度和同步控制机制。本文介绍了通过串行队列、锁、属性包装器、Dispatch Barrier 以及 Actor 模型等方式来实现原子操作的不同方法。开发者可以根据项目的实际情况选择合适的方法，既保证线程安全又能兼顾性能。",-1)])),"main-header":a(()=>[h(l.$slots,"main-header")]),"main-header-after":a(()=>[h(l.$slots,"main-header-after")]),"main-nav":a(()=>[h(l.$slots,"main-nav")]),"main-content-before":a(()=>[h(l.$slots,"main-content-before")]),"main-content":a(()=>[h(l.$slots,"main-content")]),"main-content-after":a(()=>[h(l.$slots,"main-content-after")]),"main-nav-before":a(()=>[h(l.$slots,"main-nav-before")]),"main-nav-after":a(()=>[h(l.$slots,"main-nav-after")]),comment:a(()=>[h(l.$slots,"comment")]),footer:a(()=>[h(l.$slots,"footer")]),aside:a(()=>[h(l.$slots,"aside")]),"aside-custom":a(()=>[h(l.$slots,"aside-custom")]),default:a(()=>[h(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{q as default,A as usePageData};
